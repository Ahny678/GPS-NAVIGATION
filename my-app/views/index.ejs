<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script src="/javascripts/getLoc.js"></script>
  </head>
  <body>
    <h1>Access Your GPS Location</h1>
    <p>
      Click the button below to get your current GPS coordinates and send them
      to the server.
    </p>

    <!-- Fix: call getLocation(), not showPosition() -->
    <button onclick="getLocation()">Get Location</button>

    <div id="location"></div>
    <div id="error"></div>

    <h1><%= title %></h1>

    <h3>ESP32 Status</h3>
    <p id="gpsData">Distance to obstacle: <%= espStatus.distance %> cm</p>
    <p id="targetDistance">
      Distance to target: <%= espStatus.targetDistance %> meters
    </p>
    <p id="gpsCoords">
      Current GPS: Lat=<%= espStatus.lat %>, Lon=<%= espStatus.lon %>
    </p>
    <p id="yaw">Yaw: <%= espStatus.yaw %>°</p>
    <p id="status">Status: <%= espStatus.status %></p>
    <p id="obstacle">Obstacle: <%= espStatus.obstacle %></p>
    <p id="satellites">Satellites: <%= espStatus.satellites %></p>
    <p id="mapLink">
      <a
        href="https://www.google.com/maps?q=<%= espStatus.lat %>,<%= espStatus.lon %>"
        target="_blank"
        >View on Google Maps</a
      >
    </p>

    <script>
      setInterval(() => {
        fetch("/get-status")
          .then((res) => res.json())
          .then((data) => {
            document.getElementById("gpsData").innerText =
              "Distance to obstacle: " + data.distance + " cm";
            document.getElementById("targetDistance").innerText =
              "Distance to target: " + data.targetDistance + " meters";
            document.getElementById("gpsCoords").innerText =
              "Current GPS: Lat=" + data.lat + ", Lon=" + data.lon;
            document.getElementById("yaw").innerText = "Yaw: " + data.yaw + "°";
            document.getElementById("status").innerText =
              "Status: " + data.status;
            document.getElementById("obstacle").innerText =
              "Obstacle: " + data.obstacle;
            document.getElementById("satellites").innerText =
              "Satellites: " + data.satellites;
            document.getElementById(
              "mapLink"
            ).innerHTML = `<a href="https://www.google.com/maps?q=${data.lat},${data.lon}" target="_blank">View on Google Maps</a>`;
          });
      }, 10000);
    </script>
  </body>
</html>
